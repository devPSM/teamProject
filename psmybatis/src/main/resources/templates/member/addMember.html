<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">
<th:block layout:fragment="pageTitle">
	<title th:text="${title}">addMember title</title>
	<div class="col-sm-12" th:align="center">
		<h1 class="m-0">ğŸ”‘ íšŒì›ê°€ì…ğŸ”‘</h1>
	</div><!-- /.col -->
	<div class="col-sm-12" th:align="right">
		<ol class="breadcrumb float-sm-right">
			<li class="breadcrumb-item"><a href="/">addMember</a></li>
			<li class="breadcrumb-item active">addMember.html</li>
		</ol>
	</div><!-- /.col -->
</th:block>

<th:block layout:fragment="pageJavascript">
	<script>
	$(function(){
		$('#idCheckBtn').click(function(){
			var memberId = $('input[name="memberId"]').val();
			console.log('ì…ë ¥í•œ memberIdì˜ ê°’ : ' + memberId);
			if(memberId != '' && memberId != undefined && memberId != null){
				var request = $.ajax({
					url: "/memberIdCheck",
					method: "POST",
					data: { memberId : memberId },
					dataType: "json"
				});
				request.done(function(data){
					if(data == true){
						var regExpId = /^[a-z]+[a-z0-9]{5,19}$/g;
						var idCheck = $('input[name="memberId"]');
						if(idCheck){
							if(!regExpId.test(memberId)){
								alert("ì•„ì´ë””ëŠ” ì˜ë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” 6~20ì ì˜ë¬¸ì ë˜ëŠ” ìˆ«ìì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
								idCheck.removeAttr('disabled');
								idCheck.focus();
							}else{
								alert("ì¤‘ë³µëœ ì•„ì´ë””ê°€ ì—†ìŠµë‹ˆë‹¤.");
								console.log(data);
								$('input[name="memberId"]').attr('disabled','disabled');
								$('input[name="memberPw"]').prop('disabled',false);			//prop ë°©ì‹
								$('input[name="memberName"]').prop('disabled',false);
								$('select[name="memberLevel"]').removeAttr('disabled');		//removeAttr ë°©ì‹
								$('input[name="memberEmail"]').removeAttr('disabled');
								$('input[name="memberAddr"]').removeAttr('disabled');
								$('#addMemberBtn').removeAttr('disabled');
							};
						};
					}else if(data == false){
						alert("ì¤‘ë³µëœ ì•„ì´ë””ê°€ ìˆìŠµë‹ˆë‹¤.");
						console.log(data);
					};
				});
				request.fail(function( jqXHR, textStatus ){
					alert( "Request failed: " + textStatus );
				});
			};
		});
		
		
		$('#addMemberBtn').click(function(){
			var regExpId = /^[a-z]+[a-z0-9]{5,19}$/g;
			var regExpPw = /(?=.*\d{1,50})(?=.*[~`!@#$%\^&*()-+=]{1,50})(?=.*[a-zA-Z]{2,50}).{8,50}$/;
			var regExpEmail = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
			var submitFlag = true;
			var memberForm = $('#addMemberForm');
			var inputObj = memberForm.find('input');
			
			$.each(inputObj, function(e){
				var agree = $('input[name="agreeTerms"]').attr('checked');
				var inputName = $(this).attr('name');
				var inputValue = $(this).val();
				var inputDefult = $(this).attr('data-value');
				
				if(inputName == 'memberPw'){
					if(!regExpPw.test(inputValue)){
						alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ì,íŠ¹ìˆ˜ë¬¸ì ê° 1ì ì´ìƒ, ì˜ë¬¸ì€ 2ì ì´ìƒ ì‚¬ìš©í•˜ì—¬ 8ìë¦¬ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.');
						$(this).focus();
						submitFlag = false;
						return submitFlag;
					};
				}else if(inputName == 'memberEmail'){
					if(!regExpEmail.test(inputValue)){
						alert('ì´ë©”ì¼ì„ í˜•ì‹ì— ë§ê²Œ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
						$(this).focus();
						submitFlag = false;
						return submitFlag;
					};
				}else{
					if(inputValue == '' || inputValue == undefined || inputValue == null){
						alert(inputDefult + 'ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
						$(this).focus();
						submitFlag = false;
						return submitFlag;
					};
				};
				if(agree){
					alert('íšŒì›ê°€ì…ì„ ì›í•˜ì‹œë©´ ë™ì˜ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”.');
					$(this).focus();
					submitFlag = false;
					return submitFlag;
				};
			});
			if(submitFlag) memberForm.submit();
		});
	});	
	</script>
</th:block>

<th:block layout:fragment="container">
<div class="col-sm-12" th:align="center">
	<div class="register-box">
		<div class="card">
			<div class="card-body register-card-body">
				<p class="login-box-msg">íšŒì›ê°€ì…ì„ ì§„í–‰í•˜ì—¬ ì£¼ì‹­ì‹œì˜¤.</p>
				<form id="addMemberForm" th:action="@{/addMember}" method="post">
					<div class="input-group mb-3">
						<input type="text" class="form-control" name="memberId"  placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
						<div class="input-group-append">
							<div class="input-group-text">
								<span class="fas fa-user"></span>
							</div>
				    	</div>
						<button type="button" style="margin-left: 10px" id="idCheckBtn" class="btn btn-block btn-outline-info btn-xs col-3">ì¤‘ë³µì²´í¬</button>
					</div>
					<div class="input-group mb-3">
						<input type="password" class="form-control" name="memberPw" data-value="íŒ¨ìŠ¤ì›Œë“œ" disabled="disabled" placeholder="íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥í•˜ì„¸ìš”">
						<div class="input-group-append">
							<div class="input-group-text">
								<span class="fas fa-lock"></span>
							</div>
						</div>
					</div>
					<div class="input-group mb-3">
						<input type="text" class="form-control" name="memberName" data-value="ì´ë¦„" disabled="disabled" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
						<div class="input-group-append">
							<div class="input-group-text">
								<span class="fas fa-user"></span>
							</div>
						</div>
					</div>
					<div class="input-group mb-3">
						<select name="memberLevel" style="width: 88%" disabled="disabled">
							<option value="">ê¶Œí•œì„ íƒí•˜ì„¸ìš”</option>
							<option value="1">ê´€ë¦¬ì</option>
							<option value="2">íŒë§¤ì</option>
							<option value="3">êµ¬ë§¤ì</option>
						</select>
						<div class="input-group-append">
							<div class="input-group-text">
								<span class="fas fa-user"></span>
							</div>
						</div>
					</div>
					<div class="input-group mb-3">
						<input type="email" class="form-control" name="memberEmail" data-value="ì´ë©”ì¼" disabled="disabled" placeholder="ì´ë©”ì¼ ì…ë ¥í•˜ì„¸ìš”">
						<div class="input-group-append">
							<div class="input-group-text">
								<span class="fas fa-envelope"></span>
							</div>
						</div>
					</div>
					<div class="input-group mb-3">
						<input type="text" class="form-control" name="memberAddr" data-value="ì£¼ì†Œ" disabled="disabled" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
						<div class="input-group-append">
							<div class="input-group-text">
								<span class="fas fa-user"></span>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-8" th:align="left">
							<div class="icheck-primary">
								<input type="checkbox" name="agreeTerms" value="agree">
								<label for="agreeTerms">
									I agree Resist
								</label>
							</div>
						</div>
						<!-- /.col -->
						<div class="col-4">
							<button type="submit" id="addMemberBtn" class="btn btn-primary btn-block" disabled="disabled">íšŒì›ê°€ì…</button>
						</div>
						<!-- /.col -->
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
</th:block>
</html>

